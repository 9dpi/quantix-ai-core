Rule bất biến (IMMUTABLE RULE)

Mọi kênh hiển thị (Web, Telegram, API)
chỉ được phép đọc release_confidence từ Database
→ không recompute, không fallback.

Sau khi fix

Telegram = Web = History = 1 giá trị duy nhất

Confidence trở thành immutable evidence

================================================================================
QUANTIX ECOSYSTEM – OFFICIAL TIMING & RESPONSIBILITY MAP (v3.1 – UPDATED)
================================================================================

[TIME BASE]
- Market Data: Binance EURUSDT (proxy EURUSD)
- Candle Resolution: M15
- Watcher Scan Interval: 120s (2 minutes)
- Entry Validity Window: 35 minutes (absolute)
- Trade Max Duration (after entry): 90 minutes
- Confidence: IMMUTABLE at RELEASE

--------------------------------------------------------------------------------
1. QUANTIX AI CORE (Analyzer Layer)
--------------------------------------------------------------------------------
Trigger:
- Runs on NEW CLOSED M15 candle
- Uses HISTORICAL + CURRENT structure data

Timing:
- t0 = Candle Close (e.g. 12:00, 12:15, 12:30...)

Process:
- Pattern Detection
- Structure Validation
- Raw AI Confidence computed (0–100)
- Apply filters:
  - Session
  - Volatility
  - Risk Guard

Output (ONCE ONLY):
- release_confidence (final)
- entry_price
- tp
- sl
- valid_until = t0 + 35 minutes

State Created:
- WAITING_FOR_ENTRY

Persistence:
- Signal is WRITTEN to Database (immutable record)
- Analyzer NEVER touches this signal again

--------------------------------------------------------------------------------
2. SIGNAL DATABASE (Source of Truth)
--------------------------------------------------------------------------------
At t0 + ε seconds:

Stored fields (REQUIRED):
- state = WAITING_FOR_ENTRY
- release_confidence
- generated_at
- valid_until
- entry / tp / sl
- direction

Rules:
- No recompute
- No overwrite
- release_confidence is FINAL

--------------------------------------------------------------------------------
3. SIGNAL WATCHER (Live Market Observer)
--------------------------------------------------------------------------------
Loop:
- Runs every 120 seconds
- Uses Binance LIVE price (last 2 M15 candles = 30m window)

Observes ONLY:
- Price
- Time

DOES NOT:
- Recalculate confidence
- Modify entry/tp/sl

Logic Priority (STRICT ORDER):

[1] ENTRY WINDOW CHECK
- If now > valid_until
- AND state == WAITING_FOR_ENTRY
→ Transition: CANCELLED (EXPIRED_NO_ENTRY)

[2] ENTRY HIT CHECK
- If price touches entry (using merged High/Low of last 2 candles)
→ Transition: ENTRY_HIT
→ entry_hit_at = now

[3] TP / SL CHECK (only after ENTRY_HIT)
- If TP touched → TP_HIT → CLOSE
- If SL touched → SL_HIT → CLOSE

[4] TRADE TIMEOUT
- If ENTRY_HIT and now > entry_hit_at + 90m
→ TIME_EXIT → CLOSE

--------------------------------------------------------------------------------
4. TELEGRAM SIGNAL BOT
--------------------------------------------------------------------------------
Trigger:
- LISTENS to DB state transitions (or watcher callbacks)

Timing:
- Entry Signal:
  - Sent immediately after DB confirms WAITING_FOR_ENTRY

- Entry Hit:
  - Sent immediately after state == ENTRY_HIT

- Close Events:
  - TP_HIT / SL_HIT / TIME_EXIT / CANCELLED

Rules:
- Telegram NEVER calculates confidence
- Telegram ONLY reads release_confidence from DB
- Telegram is NOT a source of truth

--------------------------------------------------------------------------------
5. SIGNALGENIUSAI.COM (Dashboard / History)
--------------------------------------------------------------------------------
Update Loop:
- Polls Database every N seconds (or via realtime)

Displays:
- ONLY release_confidence
- NEVER raw_ai_confidence

UI Timing Rules:
- When state == WAITING_FOR_ENTRY:
    Show confidence + entry info

- When state == ENTRY_HIT:
    Show confidence (frozen at release)

- When state IN (CANCELLED, TP_HIT, SL_HIT, TIME_EXIT):
    Hide or grey confidence
    Show CLOSE_REASON instead

IMPORTANT:
- Dashboard must NEVER infer or recompute anything

--------------------------------------------------------------------------------
6. HISTORY / TELEINDEX / PUBLIC INDEX
--------------------------------------------------------------------------------
Timing:
- Updated AFTER signal reaches terminal state

Stores:
- release_confidence
- entry_hit_at (if any)
- close_reason
- close_time

DOES NOT:
- Aggregate win rate
- Show performance metrics
- Rank signals

Purpose:
- Evidence
- Audit
- Immutability proof

--------------------------------------------------------------------------------
7. TELEINDEX LOOP (Public / External)
--------------------------------------------------------------------------------
Trigger:
- On signal CLOSE only

Timing:
- t_close + aggregation delay

Consumes:
- FINAL signal record only

Never uses:
- Raw AI score
- Live watcher data
- Telegram cache

--------------------------------------------------------------------------------
END STATE GUARANTEE
--------------------------------------------------------------------------------
At any time:
- Telegram == Dashboard https://github.com/9dpi/telesignal == https://github.com/9dpi/quantix-live-execution == History https://github.com/9dpi/telesignal == https://github.com/9dpi/quantix-live-execution
- 1 signal → 1 confidence → immutable
- No timing race between candle close & watcher scan
- No UI shows "100%" unless it was truly released as 100%

================================================================================
```text
8. DATA INTEGRITY AUDIT
--------------------------------------------------------------------------------
- Automated cross-check: Signal Store ↔ TeleIndex ↔ Dashboard.
- Discrepancy > 0% triggers Critical System Alert.

9. VERSIONING & RETROACTIVITY
--------------------------------------------------------------------------------
- Engine logic updates NEVER apply retroactively to closed signals.
- History = Immutable truth
